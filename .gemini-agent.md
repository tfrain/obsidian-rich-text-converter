# Gemini Agent Project Configuration

This file contains project-specific information to help the Gemini agent understand the project context and assist more efficiently.

## Project Overview

- **Project Name:** obsidian-medium-converter
- **Project Type:** Obsidian Plugin
- **Language:** TypeScript
- **Package Manager:** npm

## Development Workflow

### Build

The project is built using `esbuild` via an npm script.

- **Build command:** `npm run build`
- **Development build command:** `npm run dev`

The production build command is `tsc -noEmit -skipLibCheck && node esbuild.config.mjs production`.

### Testing & Debugging

This plugin is tested by linking it to an Obsidian vault.

- **Symlink Source:** /Users/tfrainwei/Repos/obsidian-rich-text-converter (this project's root)
- **Symlink Target:** /Users/tfrainwei/Repos/test/.obsidian/plugins/medium-rich-text-converter

To set up the development environment, run the following command:

```bash
mkdir -p /Users/tfrainwei/Repos/test/.obsidian/plugins && \
rm -rf /Users/tfrainwei/Repos/test/.obsidian/plugins/medium-rich-text-converter && \
ln -s "$(pwd)" /Users/tfrainwei/Repos/test/.obsidian/plugins/medium-rich-text-converter
```

## Key Files

- `main.ts`: The main entry point of the plugin.
- `manifest.json`: The plugin manifest file for Obsidian.
- `package.json`: Defines project scripts and dependencies.
- `esbuild.config.mjs`: The build configuration for `esbuild`.
- `tsconfig.json`: TypeScript configuration.

## Development Learnings & Pitfalls

### 1. Manual Copy vs. Button Copy Logic

**CRITICAL:** The user experience for manual copying (selecting text in the preview) and button copying ("Copy to Medium") must be consistent.

-   **Manual Copy** depends on the HTML rendered in the visible preview pane by the `getMediumHtml()` function.
-   **Button Copy** depends on the HTML generated within the `copyRenderedContent()` function.

**Lesson:** Any formatting fix or transformation intended for the clipboard **must be applied in both places**. Forgetting to update `getMediumHtml()` will cause inconsistencies where the button works but manual copying does not.

### 2. Medium.com Rich Text Editor Quirks

Medium's editor has specific expectations for pasted HTML. Standard HTML is not always sufficient.

-   **Bold Formatting:** `<strong>` tags are often ignored unless they have an inline style. The reliable solution is to render them as `<strong style="font-weight: bold;">...</strong>`.
-   **Code Blocks:** Code blocks containing empty lines (e.g., `line1\n\nline2`) are split into multiple blocks. The fix is to replace empty lines with a line containing a non-breaking space: `line1\n&nbsp;\nline2`. This should be done on the `innerHTML` of the `<code>` tag.

### 3. Clipboard API Reliability

-   The modern `navigator.clipboard.write()` API proved unreliable in the Obsidian/Electron environment, leading to a silent failure (empty clipboard).
-   The most reliable method for this project is the original pattern in `copyRenderedContent()`:
    1.  Read the `innerHTML` from the preview.
    2.  Parse and transform this HTML in-memory.
    3.  Temporarily replace the preview element's `innerHTML` with the transformed HTML.
    4.  Use `document.execCommand('copy')` on a selection of that element.
    5.  Restore the original preview `innerHTML` in a `finally` block.
-   This pattern should be preferred over other clipboard APIs to avoid regressions.
